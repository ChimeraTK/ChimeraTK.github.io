<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>mtca4u-deviceaccess: Basic Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="DESY_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mtca4u-deviceaccess
   &#160;<span id="projectnumber">00.34.00</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Basic Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>To use the mtca4u::Device class you need a so called "device map" file (dmap file).</p>
<p>It is created manually and contains information which devices are used in your application. More information can be found on the page about <a class="el" href="dmap.html">Device Mapping</a>.</p>
<p>For the beinning all you need is the alias which identifies the device. In the <code>example.dmap</code> file there is just one entry: MY_DEVICE</p>
<p>Registers are accessed by so called <code>accessors</code>. The accessors contain a buffer which stores the data which is read from or written to the hardware using <code>read()</code> and <code>write()</code> functions. When not reading or writing you can efficiently access or modify the content at will, because it is modifying the internal buffer and not talking to the hardware.</p>
<p>In this basic example are using a register which holds one value. A single value is a scalar, so we are using the ScalarRegisterAccessor. Like all accessors, it is templated to a simple (user) data type and automatically does a data conversion to this type, if needed. The ScalarRegisterAccessor behaves just like the simple data type it represents, so you can just assign to it, add, subtact, multiply or divide it, print it, ... Usually you don't allocate a variable and copy the accessor content to it (which would be really inefficient in case of large data arrays), but just use the accessor.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ChimeraTK/Device.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ChimeraTK/Utilities.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="comment">/* All information needed to access the device is</span></div><div class="line"><span class="comment"> * the device alias and the register names</span></div><div class="line"><span class="comment"> * (plus a .dmap file)</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="accessor1_d_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(){</div><div class="line">  <span class="comment">/* Before you use a device you have to tell DeviceAccess</span></div><div class="line"><span class="comment">   * which dmap file to use.</span></div><div class="line"><span class="comment">   * \todo There should be a global function to do this. It is an implementation</span></div><div class="line"><span class="comment">   * detail that it&#39;s the factory which has to know it.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <a class="code" href="namespace_chimera_t_k.html#ac081e51ebc9ef4fe64b469290d39b7a2">ChimeraTK::setDMapFilePath</a>(<span class="stringliteral">&quot;example.dmap&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* Create a device. Make sure a device alias is present</span></div><div class="line"><span class="comment">   * in the dmap file.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <a class="code" href="class_chimera_t_k_1_1_device.html">ChimeraTK::Device</a> myDevice;</div><div class="line">  myDevice.<a class="code" href="class_chimera_t_k_1_1_device.html#aedbf8aa7daab16909fe3df80c788d0bf">open</a>(<span class="stringliteral">&quot;MY_DEVICE&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* Registers are defined by a path, which consists of a hierarchy of</span></div><div class="line"><span class="comment">   *  names separated by &#39;/&#39;. In this is example it is Module/Register.</span></div><div class="line"><span class="comment">   *  In this basic example we use a register which contains a single value</span></div><div class="line"><span class="comment">   *  (a scalar).</span></div><div class="line"><span class="comment">   *</span></div><div class="line"><span class="comment">   *  The example device has a temperature controller with a set value.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">    <a class="code" href="class_chimera_t_k_1_1_scalar_register_accessor.html">ChimeraTK::ScalarRegisterAccessor&lt;float&gt;</a> temperatureSetPoint</div><div class="line">    = myDevice.<a class="code" href="class_chimera_t_k_1_1_device.html#a37f85f4e0a786ee59f39d949d4cce562">getScalarRegisterAccessor</a>&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;TEMPERATURE_CONTROLLER/SET_POINT&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* To get the value from the device call read.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  temperatureSetPoint.<a class="code" href="class_chimera_t_k_1_1_transfer_element_abstractor.html#a66980fe7b7c0dc937361e71b1750767f">read</a>();</div><div class="line"></div><div class="line">  <span class="comment">/* Now you can treat the accessor as if it was a regular float variable.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Current temperature set point is &quot;</span> &lt;&lt; temperatureSetPoint &lt;&lt; std::endl;</div><div class="line">  temperatureSetPoint += 1.5;</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Temperature set point changed to &quot;</span> &lt;&lt; temperatureSetPoint &lt;&lt; std::endl;</div><div class="line"></div><div class="line">  <span class="comment">/* After you are done manipulating the accessor write it to the hardware.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  temperatureSetPoint.<a class="code" href="class_chimera_t_k_1_1_transfer_element_abstractor.html#a281b905219e719a1a0cdbd9d8d42d1dd">write</a>();</div><div class="line"></div><div class="line">  <span class="comment">/* It is good style to close the device when you are done, although</span></div><div class="line"><span class="comment">   * this would happen automatically once the device goes out of scope.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  myDevice.<a class="code" href="class_chimera_t_k_1_1_device.html#a20ffe09ba19304ce65b85eacee93b01d">close</a>();</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h3>Side note</h3>
<p>Although the initialisation syntax of <code>_temperatureSetPoint</code> in the example above uses the equals sign, this is calling the copy constructor. Accessors intentionally don't have assignment operators (see <a class="el" href="q_and_a.html#why_no_accessor_assignment">Why do RegisterAccessors not have an assignment operator for other RegisterAccessors?</a>).</p>
<p>If you want to initialise an accessor which is already created, use <code>replace()</code>. You need this for instance if the accessor is a class member and has already been instantiated before you call devcie.getXXXAccessor() in the constructor. </p><div class="fragment"><div class="line"><a class="code" href="class_chimera_t_k_1_1_scalar_register_accessor.html">mtca4u::ScalarRegisterAccessor&lt;float&gt;</a> temperatureSetPoint;</div><div class="line">temperatureSetPoint.<a class="code" href="class_chimera_t_k_1_1_n_d_register_accessor_abstractor.html#ab6e2e3825b61976c4ad61ec9d1a7f547">replace</a>(myDevice.<a class="code" href="class_chimera_t_k_1_1_device.html#a37f85f4e0a786ee59f39d949d4cce562">getScalarRegisterAccessor</a>&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;TEMPERATURE_CONTROLLER/SET_POINT&quot;</span>));</div></div><!-- fragment --><p>Next topic: <a class="el" href="accessor1d.html">Multi Value Registers (1D Register Accessors)</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Sep 6 2018 07:53:17 for mtca4u-deviceaccess by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
