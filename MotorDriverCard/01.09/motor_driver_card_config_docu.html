<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>DFMC-MD22 Motor Controller: Why you need a motor driver card config and how to create it</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="DESY_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DFMC-MD22 Motor Controller
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Why you need a motor driver card config and how to create it </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The driver and controller chips on the MD22 need to be configured for each motor.</p>
<p>The parameters are stored in an XML file. There is one file per MD22 MotorDriverCard, so one config for two motors. The reason is that there are common registers for both motors on the controller chip, and sometimes there is information of both motors in a single register.</p>
<h1><a class="anchor" id="gui_parameters"></a>
Creating an XML config file</h1>
<p>You can use the QtMotorConfigCalculator to generate a motor config file. You need some information from the motor's data sheet: </p><ul>
<li>The maximum coil current </li>
<li>The number of full steps per turn </li>
<li>The maximum desired speed in RPMs </li>
<li>Does the motor have end switches?</li>
</ul>
<p>If the motor does have end switches, you definitely should use them for safety reasons. However, if the motor does not have end switches you have to disable them because not connected end switches are detected as 'active' and the motor would not move.</p>
<p>The other parameters usually can stay at their default values. The clock frequency if 32 MHz is hard coded in the firmware and probably will never change.</p>
<div class="image">
<img src="QtMotorConfigCalculator00.06.01.png" alt="QtMotorConfigCalculator00.06.01.png"/>
</div>
<h1><a class="anchor" id="expert_parameters"></a>
Expert Section: Manually editing the config XML file</h1>
<p>The default parameters are made to work reliably, but operation will probably not be as smooth or efficent as possible with the particular motor and use case. If you want to tweak the parameters according to the TMC429 and TMC260 data sheets, you can manually edit the entries for the corresponding classes derived from <a class="el" href="classmtca4u_1_1_t_m_c260_word.html">mtca4u::TMC260Word</a> and <a class="el" href="classmtca4u_1_1_t_m_c429_input_word.html" title="Structure of a generic single value register of the TMC429 chip. ">mtca4u::TMC429InputWord</a>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">MotorDriverCardConfig</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;coverDatagram&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;        &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;coverPositionAndLength&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;datagramHighWord&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;datagramLowWord&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;interfaceConfiguration&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x122&quot;</span> /&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;positionCompareInterruptData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;positionCompareWord&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;stepperMotorGlobalParameters&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x10701&quot;</span> /&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        &lt;<span class="keywordtype">Parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;controlerSpiWaitingTime&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;50&quot;</span> /&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        &lt;<span class="keywordtype">MotorControlerConfig</span> <span class="keyword">motorID</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;accelerationThresholdData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;chopperControlData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x1F3&quot;</span> /&gt;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;coolStepControlData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;decoderReadoutMode&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x1&quot;</span> /&gt;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;dividersAndMicroStepResolutionData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x3704&quot;</span> /&gt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;driverConfigData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x40&quot;</span> /&gt;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;driverControlData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;enabled&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;false&quot;</span> /&gt;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;interruptData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;maximumAcceleration&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x14&quot;</span> /&gt;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;maximumVelocity&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x64&quot;</span> /&gt;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;microStepCount&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;minimumVelocity&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x1&quot;</span> /&gt;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;positionTolerance&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;proportionalityFactorData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0xC50A&quot;</span> /&gt;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;referenceConfigAndRampModeData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;stallGuardControlData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x10000&quot;</span> /&gt;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;targetPosition&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0&quot;</span> /&gt;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;targetVelocity&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0&quot;</span> /&gt;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                &lt;<span class="keywordtype">Parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;driverSpiWaitingTime&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;50&quot;</span> /&gt;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        &lt;/<span class="keywordtype">MotorControlerConfig</span>&gt;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        &lt;<span class="keywordtype">MotorControlerConfig</span> <span class="keyword">motorID</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;accelerationThresholdData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;chopperControlData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x1F3&quot;</span> /&gt;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;coolStepControlData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;decoderReadoutMode&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x1&quot;</span> /&gt;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;dividersAndMicroStepResolutionData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x3704&quot;</span> /&gt;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;driverConfigData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x40&quot;</span> /&gt;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;driverControlData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;enabled&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;false&quot;</span> /&gt;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;interruptData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;maximumAcceleration&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x14&quot;</span> /&gt;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;maximumVelocity&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x64&quot;</span> /&gt;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;microStepCount&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;minimumVelocity&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x1&quot;</span> /&gt;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;positionTolerance&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;proportionalityFactorData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0xC50A&quot;</span> /&gt;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;referenceConfigAndRampModeData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x0&quot;</span> /&gt;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;stallGuardControlData&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0x10000&quot;</span> /&gt;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;targetPosition&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0&quot;</span> /&gt;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                &lt;<span class="keywordtype">Register</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;targetVelocity&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0&quot;</span> /&gt;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                &lt;<span class="keywordtype">Parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;driverSpiWaitingTime&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;50&quot;</span> /&gt;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        &lt;/<span class="keywordtype">MotorControlerConfig</span>&gt;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;&lt;/<span class="keywordtype">MotorDriverCardConfig</span>&gt;</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Feb 5 2019 06:57:18 for DFMC-MD22 Motor Controller by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
