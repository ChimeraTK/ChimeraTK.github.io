<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>DFMC-MD22 Motor Controller: mtca4u::SPIviaPCIe Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="DESY_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DFMC-MD22 Motor Controller
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacemtca4u.html">mtca4u</a></li><li class="navelem"><a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html">SPIviaPCIe</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="classmtca4u_1_1_s_p_ivia_p_c_ie-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">mtca4u::SPIviaPCIe Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This class implements synchronous SPI operation over PCIexpress, using an SPI command register and a synchronisation register.  
 <a href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_s_p_ivia_p_c_ie_8h_source.html">SPIviaPCIe.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0db2ba0f02f2aefad79aabbb681172a4"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#a0db2ba0f02f2aefad79aabbb681172a4">getSpiWaitingTime</a> () const </td></tr>
<tr class="memdesc:a0db2ba0f02f2aefad79aabbb681172a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read back the waiting time which is set.  <a href="#a0db2ba0f02f2aefad79aabbb681172a4">More...</a><br /></td></tr>
<tr class="separator:a0db2ba0f02f2aefad79aabbb681172a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a235f3bdd4b7931219c04526273f948a1"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#a235f3bdd4b7931219c04526273f948a1">read</a> (int32_t spiCommand)</td></tr>
<tr class="memdesc:a235f3bdd4b7931219c04526273f948a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write the command and return the readback value.  <a href="#a235f3bdd4b7931219c04526273f948a1">More...</a><br /></td></tr>
<tr class="separator:a235f3bdd4b7931219c04526273f948a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8dd651d92edcc34ed91cfe5add7b4c28"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#a8dd651d92edcc34ed91cfe5add7b4c28">setSpiWaitingTime</a> (unsigned int microSeconds)</td></tr>
<tr class="memdesc:a8dd651d92edcc34ed91cfe5add7b4c28"><td class="mdescLeft">&#160;</td><td class="mdescRight">The FPGA needs some time to perform the SPI communication to the connected chip.  <a href="#a8dd651d92edcc34ed91cfe5add7b4c28">More...</a><br /></td></tr>
<tr class="separator:a8dd651d92edcc34ed91cfe5add7b4c28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3650dc91c467c7c5d954951cbe95c23"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#ac3650dc91c467c7c5d954951cbe95c23">SPIviaPCIe</a> (boost::shared_ptr&lt; ChimeraTK::Device &gt; const &amp;device, std::string const &amp;moduleName, std::string const &amp;writeRegisterName, std::string const &amp;syncRegisterName, unsigned int spiWaitingTime=<a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#a0b12fea46722b0d69f116e90265b9273">SPI_DEFAULT_WAITING_TIME</a>)</td></tr>
<tr class="memdesc:ac3650dc91c467c7c5d954951cbe95c23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor for write-only implementations.  <a href="#ac3650dc91c467c7c5d954951cbe95c23">More...</a><br /></td></tr>
<tr class="separator:ac3650dc91c467c7c5d954951cbe95c23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af56cd949070a75797995219eb81b0515"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#af56cd949070a75797995219eb81b0515">SPIviaPCIe</a> (boost::shared_ptr&lt; ChimeraTK::Device &gt; const &amp;device, std::string const &amp;moduleName, std::string const &amp;writeRegisterName, std::string const &amp;syncRegisterName, std::string const &amp;readbackRegisterName, unsigned int spiWaitingTime=<a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#a0b12fea46722b0d69f116e90265b9273">SPI_DEFAULT_WAITING_TIME</a>)</td></tr>
<tr class="memdesc:af56cd949070a75797995219eb81b0515"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor for write and readback.  <a href="#af56cd949070a75797995219eb81b0515">More...</a><br /></td></tr>
<tr class="separator:af56cd949070a75797995219eb81b0515"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b8c8b62747147e0540d26d312b86cce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#a5b8c8b62747147e0540d26d312b86cce">write</a> (int32_t spiCommand)</td></tr>
<tr class="memdesc:a5b8c8b62747147e0540d26d312b86cce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write the spi command.  <a href="#a5b8c8b62747147e0540d26d312b86cce">More...</a><br /></td></tr>
<tr class="separator:a5b8c8b62747147e0540d26d312b86cce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a0b12fea46722b0d69f116e90265b9273"><td class="memItemLeft" align="right" valign="top">static unsigned int const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#a0b12fea46722b0d69f116e90265b9273">SPI_DEFAULT_WAITING_TIME</a> = 40</td></tr>
<tr class="memdesc:a0b12fea46722b0d69f116e90265b9273"><td class="mdescLeft">&#160;</td><td class="mdescRight">microseconds  <a href="#a0b12fea46722b0d69f116e90265b9273">More...</a><br /></td></tr>
<tr class="separator:a0b12fea46722b0d69f116e90265b9273"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class implements synchronous SPI operation over PCIexpress, using an SPI command register and a synchronisation register. </p>
<p>Readback is optional. </p>

<p>Definition at line <a class="el" href="_s_p_ivia_p_c_ie_8h_source.html#l00013">13</a> of file <a class="el" href="_s_p_ivia_p_c_ie_8h_source.html">SPIviaPCIe.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ac3650dc91c467c7c5d954951cbe95c23"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mtca4u::SPIviaPCIe::SPIviaPCIe </td>
          <td>(</td>
          <td class="paramtype">boost::shared_ptr&lt; ChimeraTK::Device &gt; const &amp;&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string const &amp;&#160;</td>
          <td class="paramname"><em>moduleName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string const &amp;&#160;</td>
          <td class="paramname"><em>writeRegisterName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string const &amp;&#160;</td>
          <td class="paramname"><em>syncRegisterName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>spiWaitingTime</em> = <code><a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#a0b12fea46722b0d69f116e90265b9273">SPI_DEFAULT_WAITING_TIME</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor for write-only implementations. </p>
<p>It intentionally is overloaded and not a version with an invalid default value for the readback register because the register accessors have to be implemented in the initialiser list, and case switches there would be messy.</p>
<p>The spi command has to be composed by the calling code in order to keep this class universal.</p>
<p>The spiWaitingTime is in microseconds. It defaults to 40 microseconds which should be ok for writing 32 bits at 1 MHz.</p>
<p>An internal copy of the shared pointer of the mapped device is held in this class, so the <a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html" title="This class implements synchronous SPI operation over PCIexpress, using an SPI command register and a ...">SPIviaPCIe</a> always stays valid, even if the original shared pointer goes out of scope. </p>

<p>Definition at line <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html#l00014">14</a> of file <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html">SPIviaPCIe.cc</a>.</p>

</div>
</div>
<a class="anchor" id="af56cd949070a75797995219eb81b0515"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mtca4u::SPIviaPCIe::SPIviaPCIe </td>
          <td>(</td>
          <td class="paramtype">boost::shared_ptr&lt; ChimeraTK::Device &gt; const &amp;&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string const &amp;&#160;</td>
          <td class="paramname"><em>moduleName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string const &amp;&#160;</td>
          <td class="paramname"><em>writeRegisterName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string const &amp;&#160;</td>
          <td class="paramname"><em>syncRegisterName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string const &amp;&#160;</td>
          <td class="paramname"><em>readbackRegisterName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>spiWaitingTime</em> = <code><a class="el" href="classmtca4u_1_1_s_p_ivia_p_c_ie.html#a0b12fea46722b0d69f116e90265b9273">SPI_DEFAULT_WAITING_TIME</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor for write and readback. </p>

<p>Definition at line <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html#l00030">30</a> of file <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html">SPIviaPCIe.cc</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a0db2ba0f02f2aefad79aabbb681172a4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int mtca4u::SPIviaPCIe::getSpiWaitingTime </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read back the waiting time which is set. </p>

<p>Definition at line <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html#l00134">134</a> of file <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html">SPIviaPCIe.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a235f3bdd4b7931219c04526273f948a1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t mtca4u::SPIviaPCIe::read </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>spiCommand</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write the command and return the readback value. </p>

<p>Definition at line <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html#l00100">100</a> of file <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html">SPIviaPCIe.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a8dd651d92edcc34ed91cfe5add7b4c28"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mtca4u::SPIviaPCIe::setSpiWaitingTime </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>microSeconds</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The FPGA needs some time to perform the SPI communication to the connected chip. </p>
<p>This is the waiting time between the checks of the synchronisation register. It should be set to approximately the time needed for the SPI communication (a little bit larger to compensate for time jitter, so only one waiting cycle is needed). Don't set it to 0 because after 10 attempts without valid synchronisation the read/write operation is timed out and an error is reported. </p>

<p>Definition at line <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html#l00129">129</a> of file <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html">SPIviaPCIe.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a5b8c8b62747147e0540d26d312b86cce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mtca4u::SPIviaPCIe::write </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>spiCommand</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write the spi command. </p>
<p>This methods blocks until the firmware has returned either success or an error. In case of an error a <a class="el" href="classmtca4u_1_1_motor_driver_exception.html" title="The type of exception thrown by MotorDriverCard and MotorControler. ">MotorDriverException</a> is thrown. After 10 waiting cycles and checks of the synchronisation register the operation is timed out and a <a class="el" href="classmtca4u_1_1_motor_driver_exception.html" title="The type of exception thrown by MotorDriverCard and MotorControler. ">MotorDriverException</a> is thrown.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="classmtca4u_1_1_motor_driver_exception.html" title="The type of exception thrown by MotorDriverCard and MotorControler. ">MotorDriverException</a></td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html#l00046">46</a> of file <a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html">SPIviaPCIe.cc</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a0b12fea46722b0d69f116e90265b9273"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int const mtca4u::SPIviaPCIe::SPI_DEFAULT_WAITING_TIME = 40</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>microseconds </p>

<p>Definition at line <a class="el" href="_s_p_ivia_p_c_ie_8h_source.html#l00015">15</a> of file <a class="el" href="_s_p_ivia_p_c_ie_8h_source.html">SPIviaPCIe.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/msk_jenkins/workspace/ChimeraTK_documentation_update/checkouts/MotorDriverCard/include/impl/<a class="el" href="_s_p_ivia_p_c_ie_8h_source.html">SPIviaPCIe.h</a></li>
<li>/home/msk_jenkins/workspace/ChimeraTK_documentation_update/checkouts/MotorDriverCard/src/<a class="el" href="_s_p_ivia_p_c_ie_8cc_source.html">SPIviaPCIe.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 2 2018 07:56:23 for DFMC-MD22 Motor Controller by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
