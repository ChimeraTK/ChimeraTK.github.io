<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ChimeraTK-DeviceAccess: doc/spec_TransferElement.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ChimeraTK_Logo_whitebg.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ChimeraTK-DeviceAccess
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('spec___transfer_element_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">doc/spec_TransferElement.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="spec___transfer_element_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Technical specification: TransferElement {#spec_TransferElement}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;========================================</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&gt; **DRAFT VERSION, WRITE-UP IN PROGRESS!**</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;This currently is just a stub with detail snippets.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;## Introduction ##</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;## Unsorted collection of details ###</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;* preXxx and postXxx are called always in pairs. Reason: It might be that the user buffer has to be swapped out during the transfer (while taking away the ownership of the calling code), and this must be restored in the postXxx action.</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;* This holds even if exceptions (both ChimeraTK::logic_error and ChimeraTK::runtime_error, and also boost::thread_interrupted and boost::numeric::bad_numeric_cast) are thrown.</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;* If in preXxx an exception is thrown, the corresponding xxxTransferYyy is not called, instead directly postXxx is called.</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;* Exceptions thrown in preXxx or xxxTransferYyy are caught and delayed until postXxx by the framework. This ensures that preXxx and postXxx are always called in pairs.</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;* Other exceptins then ChimeraTK::logic_error, ChimeraTK::runtime_error, also boost::thread_interrupted and boost::numeric::bad_numeric_cast are not allowed to be thrown or passed through at any place under any circumstance (unless of course they are guaranteed to be caught before they become visible to the application, like the detail::DiscardValueException). The framework (in particular ApplicationCore) may use &quot;uncatchable&quot; exceptions in some places to force the termination of the application. Backend implementations etc. may not do this, since it would lead to uncontrollable behaviour.</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;Requirement for backend/decoractor implementations:</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;* In the constructor, *only* ChimeraTK::logic_errror must be thrown.</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;* In doPreXxx, *only* ChimeraTK::logic_errror must be thrown. In doPreWrite, boost::numeric::bad_numeric_cast can in addition be thrown.</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;* In doXxxTransferYyy, *only* ChimeraTK::runtime_error must be thrown</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;* In doPostXxx, *only* exceptions that were risen in doPreXxx or doXxxTransferYyy may be rethrown. This is done by the TransferElement base class in postXxx, so implementations should never actively throw these exceptions in doPostXxx (but decorators must expect exceptions to be thrown by delegated calls). In doPostRead, boost::numeric::bad_numeric_cast may in addition be thrown (also directly), but only if hasNewData == true.</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;* In addition to the above rules, boost::thread_interrupted may be thrown at any phase, if TransferElement::interrupt has been called. This exception will also be delayed and rethrown in doPostXxx by the TransferElement base class.</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;* ChimeraTK::logic_errors must follow strict conditions. Any logic_error must be thrown as early as possible. Also logic_erors must always be avoidable by calling the corresponding test functions before executing a potentially failing action. (Note: test functions do not yet exist for everything, this needs to be changed!). In particular:</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  * in the accessor&#39;s constructor, a logic_error must only be thrown if:</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    * no register exists by that name in the catalogue (note: it is legal to provide &quot;hidden&quot; registers not present in the catalogue, but a register listed in the catalogue must always work)</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  * in doPreRead(), a logic_error must be thrown if and only if:</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    * backend-&gt;isOpened() == false</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    * isReadable() == false</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  * in doPreWrite(), a logic_error must be thrown if and only if:</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    * backend-&gt;isOpened() == false</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    * isWriteable() == false</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  * To comments about how to follow these rules:</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    * If there is an error in the map file and the backend does not want to fail on this in backend creation, the register must be hidden from the catalogue.</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    * If a backend cannot decide the existence of a register in the accessor&#39;s constructor (because there is no map file or such, and the backend might be closed), it needs to check the presence also e.g. in isReadable() and isWriteable(). TBD: Shall isReadable()/isWriteable() throw in that case or return false?</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;### Decorators including decorator-like implementations ###</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;* All functions doPreXxx, doXxxTransferYyy and doPostXxx must delegate to their non-do counterparts (preXxx, xxxTransferYyy and postXxx). Never delegate to the do... of the target implementation functions directly.</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;* If a function of the same instance should be called, e.g. if doReadTransferLatest should redirect to doReadTransfer or if doPostRead should call doPostRead of a base class, call to do-version of the function. This is merely to avoid code duplication, hence the surrounding logic of the non-do function is not wanted here.</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;* Decorators must merely delegate doXxxTransferYyy, never add any functionalty there. Reason: TransferGroup might effectively bypass the decorator implementation</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="spec___transfer_element_8md.html">spec_TransferElement.md</a></li>
    <li class="footer">Generated on Thu Apr 23 2020 07:37:49 for ChimeraTK-DeviceAccess by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
