<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>watchdog-server: Watchdog server</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="hzdr_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">watchdog-server
   &#160;<span id="projectnumber">@watchdog-server_VERSION@</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Watchdog server </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The watchdog server is used to monitor the system, the watchdog itself and addition processes (started by the watchdog) with respect to their memory consumption, runtime and more.</p>
<h2>Details about the watchdog server and its operation</h2>
<p>Before starting the watchdog server the number of processes to be controlled needs to be fixed. This is done by modifying the config file <code>WatchdogServerConfig.xml</code> (installed in <code>/etc/chimeratk/watchdog-server/</code>). Here you only need to give a name to the process to be added. All process specific settings are done via the watchdog server when it is started.</p>
<p>In the server settings you can set a path (<code>SetPath</code>), where to execute the program specified in the CMD variable. You can also append command line arguments to the commad set in <code>SetCMD</code>. In order to add environment settings use <code>SetEnvironment</code>, e.g. <code>"ENSHOST=localhost"</code>. Separate multiple variables in the environment with a comma and multiple entries per variable with a colon, e.g. <code>"ENSHOST=localhost,PYTHONPATH=/locationA:/locationB"</code>. A process is started using <code>enableProcess=1</code> and stopped using <code>enableProcess=0</code>. Stopping a process means sending the signal defined in <code>killSig</code> (default: <code>SIGINT</code>) to the process. If the process is not stopped by that signal after the defined <code>killTimeout</code> (default: 1s) the process will be killed using <code>SIGKILL</code>. If stopping your process needs longer than 1s adjust <code>killTimeout</code> in order to end your process in a defined way. You can even set <code>killTimeout</code> to a long time, since the watchdog is testing the process status during the kill timeout periodically every second and stopps when the process exited. So far it is not possible to add processes dynamically.</p>
<p>Further information are given in the doxygen documentation of the project.</p>
<p><b>In order to add a process you need to stop (see below) the watchdog server and modify the file WatchdogServerConfig.xml.</b></p>
<p>For integration tasks all server variables can be found in <code>/etc/chimeratk/watchdog-server/WatchdogServer.xml</code>. It is created during the install process. Once you edit <code>WatchdogServerConfig.xml</code> the variable tree of the server changes. In that case use <code>watchdog-server-xmlGenerator</code> to recreate <code>/etc/chimeratk/watchdog-server/WatchdogServer.xml</code> with an updated variable tree. This is the reason why also <code>watchdog-server-xmlGenerator</code> is installed in addition to the <code>/etc/chimeratk/watchdog-server/WatchdogServer.xml</code> file.</p>
<p>When upgrading the watchdag server package the persist file is temporaryly copied to <code>/etc/chimeratk/watchdog-server/</code> and treated as configuration file. In consequence the persist file is the same after upgrading the watchdog server packge. This is also true if the watchdog server package is removed and installed again later. Only purging the watchdog server package will remove the persist file and all the other configuration files.</p>
<h3>MicroDAQ</h3>
<p>It also possible to aquire parameters of the watchdog in a file, produced by the <code>MicroDAQ</code> module from <code>ApplicationCore</code>. In order to enable this feature the <code>WatchdogServerConfig.xml</code> file needs to be changed accordingly. </p><pre class="fragment">&lt;variable name="enableMicroDAQ" type="int32" value="1" /&gt;
</pre><p>If MicroDAQ is enabled the collected data are stored in <code>/var/lib/chimeratk/watchdog-server/uDAQ</code>. In order to change this location put a symbilc link named <code>uDAQ</code> there. If you upgrade the watchdog server the uDAQ folder will be kept, whereas in case of removing the watchdog server package the folder or symlink <code>uDAQ</code> is removed too.</p>
<h3>Server history</h3>
<p>It is possible to create a history of selected variables by the server. The history of variables is enabled in the code by adding the tag <code>History</code>. In the <code>WatchdogServerConfig.xml</code> file the history can be enabled and the length can be set: </p><pre class="fragment">&lt;variable name="enableServerHistory" type="int32" value="1" /&gt;
&lt;variable name="serverHistoryLength" type="int32" value="1200" /&gt; 
</pre><p>All history traces are out into <code>history</code> and named like the feeding server variables. In case of feeding arrays a history arry for each array element is created and the element index is appended to the hiostory trace name.</p>
<h2>Watchdog server service</h2>
<p>The watchdog server will be started automatically after the package is installed if systemd is available on the host system. In order to check the watchdog service status use the command: </p><pre class="fragment">sudo systemctl status chimeratk-watchdog.service
</pre><p>Other options are <code>stop</code> used to disable the watchdog service or <code>start</code> used to enable it again. If the watchdog server dies for some reason it is restarted 1 minute after it exited. Furthermore the watchdog server will be started automatically during booting the system. In some cases, certain processes require other processes to be running before being started. This can be achieved by using the watchdog server variable <code>BootDelay</code>, which introduces a delayed process start with respect to the Watchdog server start. The delay time needs to be tuned by the user. One could also consider to test the status of certain processes started by the Watchdog server directly. But the indication (<code>isRunning</code>) given by the Watchdog server does not guarantee that the started service is actuall set up completely. E.g. after starting the x2timer it takes some time until its Macropulse number is available to other servers.</p>
<h3>RPC bind</h3>
<p>If some processes started by the watchdog server require <code>rpcbind</code> the service file has to adopted in order to start <code>rpcbind</code> before the watchdog server. </p><pre class="fragment">#/etc/chimeratk/watchdog-server/chimeratk-watchdog.service
[Unit]
Description=ChimeraTK Watchdog Server
Wants=rpcbind.service
After=network.target local-fs.target rpcbind.target
...
</pre><p>After editing the service file update systemd: </p><pre class="fragment">systemctl daemon-reload
</pre><h2>Logging</h2>
<p>The watchdog server logging system uses different severity levels (<em>DEBUG</em>, <em>INFO</em>, <em>WARNING</em>, <em>ERROR</em>, <em>SILENT</em>). The default severity level is <em>DEBUG</em>. The severity level can be set for all process and the watchdog itself individually. Furthermore, the output stream of the logging messages can be set for all preccesses and the watchdog itself individually. By default messages are send to stdout and stderr. If a logfile name for the watchdog is set (<em>watchdog/SetLogFile</em>), messages are written to the corresponding logfile in addition. All processes and the watchdog write to the same logfile. The tail of this logfile can be inspected using <em>watchdog/LogfileTailExternal</em>. The length of the tail is controlled using <em>watchdog/SetTailLenght</em>. In contrast to this tail, the variable <em>watchdog/LogTail</em> only includes messages by the watchdog process. Similar each process provides his own messages: <em>process/LogTail</em>. The <em>LogFileTailExternal</em> variable includes the outpout of the process stared by the watchdog. This requires setting a logfile name for the process to be started (<em>process/SetLogfileExternal</em>). Again, for each process you can choose the output stream of the output produced by the started process using (<em>process/SetTargetStream</em>) and the severity level (<em>process/SetLogLevel</em>).</p>
<p>If the watchdog server is started as a service (see above) the latest messages can be seen when checking its status as described above. More output can be inspected using </p><pre class="fragment">journalctl -ex
</pre><p>Remember this output could be supressed by choosing the logfile as target output stream and setting a logfile name. In this case nothing will be seen using the <code>journalctl</code> command, but all output will end up in the logfile. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
