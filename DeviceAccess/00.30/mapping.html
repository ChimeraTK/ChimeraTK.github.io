<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>mtca4u-deviceaccess: Using the register name mapping</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="DESY_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mtca4u-deviceaccess
   &#160;<span id="projectnumber">00.30.00</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Using the register name mapping </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="deprecated"><dt><b><a class="el" href="deprecated.html#_deprecated000082">Deprecated:</a></b></dt><dd></dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000081">Todo:</a></b></dt><dd>FIXME: This page is deprecated.</dd></dl>
<p>Needs to be updated to describe the mapping, and that it's for certain Backends only. </p><dl class="deprecated"><dt><b><a class="el" href="deprecated.html#_deprecated000083">Deprecated:</a></b></dt><dd></dd></dl>
<p>To use the register name mapping you need a mapping file with the register names and properties (comes with the firmware). Each register is identified by a register name and a module name. In the mapping file the first column is a combination of module and register name (MODULE_NAME.REGISTER_NAME).</p>
<dl class="section note"><dt>Note</dt><dd>For historical reasons there are two kinds of mapping files: *.map and *.mapp<br />
 .map files can be with out without module name. *.mapp always have a module name. To use a *.map file without module names take an empty string as module name.</dd></dl>
<p>The class which provides acces with name mapping is mtca4u::Device. In addition to the read and write functions of DeviceBackend it provides read functions which take register and module name instead of its address and bar. To open the device, you give the name of the map file in addition.</p>
<p>FIXME: Here was an example which has been removed.</p>
<h1><a class="anchor" id="accessors"></a>
Register accessors</h1>
<p>To repeatedly look up the address of a name during run time is not efficient. This is solved by mtca4u::device::RegisterAccessor objects, which cache the address.</p>
<div class="fragment"><div class="line"><span class="comment">// Inefficient due to repeated table look-up of the address</span></div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 1000; ++i){</div><div class="line">  myDevice.<a class="code" href="class_chimera_t_k_1_1_device.html#aa6c9fa85aca91ab0dce1717db8b1863d">writeReg</a>(REGISTER_NAME, MODULE_NAME, &amp;i);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Better use an accessor</span></div><div class="line">mtca4u::device::RegisterAccessor accessor </div><div class="line">    =  myDevice.<a class="code" href="class_chimera_t_k_1_1_device.html#ac78a8e72c0d8636d9af8d9e3c39dec2c">getRegisterAccessor</a>(REGISTER_NAME, MODULE_NAME);</div><div class="line"></div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 1000; ++i){</div><div class="line">  accessor.writeReg(&amp;i);</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="fixed_point_conversion"></a>
Fixed point conversion</h2>
<p>In the FPGA, words are often interpreted in fixed point representation. On the CPU usually floating point is used. In addition to the raw read, accessors also contain a fixed point converter. If the fixed point representation of the register is in the mapping file, the read and write functions allow to directly use the floating point representation in the user code.</p>
<div class="fragment"><div class="line">accessor.write(17.5);</div><div class="line"><span class="keywordtype">float</span> value = accessor.read&lt;<span class="keywordtype">float</span>&gt;();</div></div><!-- fragment --><p>Complete example: FIXME: Here was an example which has been removed.</p>
<p><a class="el" href="dmap.html">Device Mapping</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Feb 23 2018 05:53:20 for mtca4u-deviceaccess by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
