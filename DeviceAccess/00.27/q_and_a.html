<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>mtca4u-deviceaccess: Questions and Answers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="DESY_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mtca4u-deviceaccess
   &#160;<span id="projectnumber">00.27.01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Questions and Answers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page is answering questions which users have asked when working with the DeviceAccess Library.</p>
<h1><a class="anchor" id="why_no_accessor_assignment"></a>
Why do RegisterAccessors not have an assignment operator for other RegisterAccessors?</h1>
<p>We decided to explicitly disable the assignmet of one accessor to another because it is ambiguous what the excpected behaviour is:</p><ul>
<li>Assign the data values of the other accessor?</li>
<li>Replace the complete accessor, incl. the register it points to. Depending on the contect where you use it you might expect either, so we decided to disable it to avoid unexpected behaviour.</li>
</ul>
<p>Use explicit conversion and replace() (defined in the <a class="el" href="classmtca4u_1_1_n_d_register_accessor_bridge.html" title="Base class for the reigster accessor bridges (ScalarRegisterAccessor, OneDRegisterAccessor and TwoDRe...">NDRegisterAccessorBridge</a> base class) to disctinguish which functionalitily you want:</p>
<div class="fragment"><div class="line"><span class="comment">// Note: This is calling the copy constructor, not the assignment operator.</span></div><div class="line"><span class="keyword">auto</span> a = _device-&gt;getScalarRegisterAccessor&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;REG_A&quot;</span>);</div><div class="line"><span class="keyword">auto</span> b = _device-&gt;getScalarRegisterAccessor&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;REG_B&quot;</span>);</div><div class="line"> </div><div class="line">a = int(b);   <span class="comment">// replace the value of &#39;a&#39; with the value of &#39;b&#39;</span></div><div class="line">a.replace(b); <span class="comment">// replace the whole accessor, now &#39;a&#39; points to REG_B</span></div></div><!-- fragment --><h3>Details:</h3>
<p>The original implementation had the default assignment operator which would replace the whole accessor, incl. the register it points to. This is what you need in the constructor of a class to initialise its member accessors: </p><div class="fragment"><div class="line"><span class="comment">// in the header (class definition)</span></div><div class="line">ScalarRegisterAccessor&lt;int&gt; _a,_b;</div><div class="line"></div><div class="line"><span class="comment">// in the .cc file (implementation of the constructor)</span></div><div class="line">_a = _device-&gt;getScalarRegisterAccessor&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;REG_A&quot;</span>);</div><div class="line">_b = _device-&gt;getScalarRegisterAccessor&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;REG_B&quot;</span>);</div></div><!-- fragment --><p>In addition the Accessors have operators which let you treat it like the primitive data type it represents (or the std::vector of it):</p>
<div class="fragment"><div class="line">_a = 7;    <span class="comment">// Assigment for int works, explicitly defined</span></div><div class="line">_b.read();</div><div class="line">_a += _b;  <span class="comment">// Works through implicit conversion,</span></div><div class="line">           <span class="comment">// increases the content of _a by the content of _b.</span></div><div class="line">_a.write();</div></div><!-- fragment --><p>With the assignment operator, however, this leads to unexpected behaviour:</p>
<div class="fragment"><div class="line">_a = _b * 2; <span class="comment">// replaces the value  of _a with 2* value of _b</span></div><div class="line">_a = _b;     <span class="comment">// WHOOPS, _a now points to &quot;REG_B&quot;</span></div></div><!-- fragment --><p>If we would have designed the assignment operator to only replace the value, the initialisation of the variable would behave unintuitively:</p>
<div class="fragment"><div class="line"><span class="comment">// This works as expected because in fact the copy constructor is called, </span></div><div class="line"><span class="comment">// although the syntax uses the euqals sign.</span></div><div class="line"><span class="keyword">auto</span> c = _device-&gt;getScalarRegisterAccessor&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;REG_C&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// This does not work. &#39;d&#39; is not initialised yet and the value assignment</span></div><div class="line"><span class="comment">// is called, which leads to an assertion because of null pointer</span></div><div class="line"><span class="comment">// dereferencing at run time.</span></div><div class="line">ScalarRegisterAccessor&lt;int&gt; d;</div><div class="line">d = _device-&gt;getScalarRegisterAccessor&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;REG_D&quot;</span>);</div></div><!-- fragment --><p>Hence, we decided that there is no intuitive implementation for the assigment operator and explicitly deactivated it. The last example assigning to <code>d</code> will already fail at compile time. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 2 2017 21:11:44 for mtca4u-deviceaccess by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
